<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jdbc="http://www.springframework.org/schema/jdbc"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/jdbc 
	http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
	http://www.springframework.org/schema/tx 
	http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">
	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>/WEB-INF/conf/exam.properties</value>
			</list>
		</property>
	</bean>
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${driverClassName}" />
		<property name="url" value="${url}" />
		<property name="username" value="${username}" />
		<property name="password" value="${password}" />
		<property name="maxActive" value="30" />
		<property name="maxIdle" value="20" />
		<property name="initialSize" value="10" />
		<property name="maxWait" value="1000" />
		<property name="defaultAutoCommit" value="true" />
		<property name="removeAbandoned" value="true" />
		<property name="removeAbandonedTimeout" value="60" />
		<property name="logAbandoned" value="true" />
	</bean>
	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="mappingResources">
			<list>
				<value>model/Apply.hbm.xml</value>
				<value>model/City.hbm.xml</value>
				<value>model/Depart.hbm.xml</value>
				<value>model/Office.hbm.xml</value>
				<value>model/User.hbm.xml</value>
				<value>model/Master.hbm.xml</value>
				<value>model/Exam.hbm.xml</value>
				<value>model/Admin.hbm.xml</value>
				<value>model/Room.hbm.xml</value>
				<value>model/Seat.hbm.xml</value>
				<value>model/Admission.hbm.xml</value>
				<value>model/RoomOffice.hbm.xml</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<value>
				hibernate.dialect=org.hibernate.dialect.MySQLDialect
				hibernate.current_session_context_class=thread
			</value>
		</property>
	</bean>
	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<!-- 定义事务管理器（声明式的事务） -->
	<bean id="transactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<!-- use declarative transaction management -->
	<tx:annotation-driven transaction-manager="transactionManager" />

	<bean id="adminInterceptor" class="interceptor.AdminInterceptor" >
		<property name="adminUrls">
			<list>
				<value>/signuppeopleinfo.action</value>
				<value>/verify.action</value>
				<value>/signupdetailsearch.action</value>
				<value>/adminInit.action</value>
				<value>/modifyAdmin.action</value>
				<value>/roomEdit.action</value>
				<value>/roomList.action</value>
				<value>/roomAssign.action</value>
				<value>/userPasswordReset.action</value>
				<value>/userSeatReset.action</value>
				<value>/seatList.action</value>
			</list>
		</property>
	</bean>

	<bean id="simpleUrlMapping"
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="adminInterceptor" />
			</list>
		</property>
		<property name="mappings">
			<props>
				<prop key="/regist.action">registController</prop>
				<prop key="/applyinfo.action">applyInfoController</prop>
				<prop key="/signuppeopleinfo.action">signUpPeopleInfoController</prop>
				<prop key="/modifyPassword.action">modifyPasswordController</prop>
				<prop key="/statusSearch.action">statusSearchController</prop>
				<prop key="/verify.action">verifyController</prop>
				<prop key="/adminLogin.action">adminLoginController</prop>
				<prop key="/adminInit.action">adminInitController</prop>
				<prop key="/modifyAdmin.action">adminModifyController</prop>
				<prop key="/adminLogout.action">adminLogoutController</prop>
				<prop key="/signupdetailsearch.action">signupDetailSearchController</prop>
				<prop key="/roomEdit.action">roomEditController</prop>
				<prop key="/roomList.action">roomListController</prop>
				<prop key="/admissionPrint.action">admissionPrintController</prop>
				<prop key="/userPasswordReset.action">userPasswordResetController</prop>
				<prop key="/userSeatReset.action">userSeatResetController</prop>
				<prop key="/roomAssign.action">roomAssignController</prop>
				<prop key="/seatList.action">seatListController</prop>
				<prop key="/scoreSearch.action">scoreSearchController</prop>
			</props>
		</property>
	</bean>

	<bean id="userDao" class="dao.UserDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="departDao" class="dao.DepartDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="cityDao" class="dao.CityDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="officeDao" class="dao.OfficeDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="applyDao" class="dao.ApplyDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="masterDao" class="dao.MasterDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="examDao" class="dao.ExamDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="adminDao" class="dao.AdminDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="roomDao" class="dao.RoomDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="admissionDao" class="dao.AdmissionDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean id="registService" class="service.RegistServiceImpl">
		<property name="userDao" ref="userDao" />
		<property name="departDao" ref="departDao" />
		<property name="cityDao" ref="cityDao" />
		<property name="officeDao" ref="officeDao" />
		<property name="applyDao" ref="applyDao" />
		<property name="masterDao" ref="masterDao" />
		<property name="examDao" ref="examDao" />
		<property name="adminDao" ref="adminDao" />
		<property name="admissionDao" ref="admissionDao" />
	</bean>
	<bean id="roomService" class="service.RoomServiceImpl">
		<property name="resetAdmissionAfterPrint" value="${resetAdmissionAfterPrint}" />
		<property name="seatsPerRoom" value="${seatsPerRoom}" />
		<property name="userDao" ref="userDao" />
		<property name="departDao" ref="departDao" />
		<property name="officeDao" ref="officeDao" />
		<property name="roomDao" ref="roomDao" />
		<property name="examDao" ref="examDao" />
		<property name="applyDao" ref="applyDao" />
		<property name="admissionDao" ref="admissionDao" />
	</bean>
	<bean id="registController" class="controller.RegistWizardController">
		<property name="successView" value="success" />
		<property name="cancelView" value="init" />
		<property name="commandName" value="RegistCommand" />
		<property name="commandClass" value="command.RegistCommand" />
		<property name="registService" ref="registService" />
		<!---配置操作类 -->
		<property name="pages">
			<list>
				<value>regist/inputUserInfo</value>
				<value>regist/doReg</value>
				<value>regist/regprotocol</value>
				<value>regist/doRegQualify</value>
				<value>regist/selectPost</value>
				<value>regist/uploadPhoto</value>
				<value>regist/confirmInfo</value>
			</list>
		</property>
		<property name="validator">
			<bean class="validator.RegistValidator"></bean>
		</property>
	</bean>
	<bean id="applyInfoController" class="controller.ApplyInfoController">
		<property name="successView" value="success" />
		<property name="formView" value="signUpSearch" />
		<property name="commandName" value="RegistCommand" />
		<property name="commandClass" value="command.RegistCommand" />
		<property name="registService" ref="registService" />
	</bean>
	<bean id="signUpPeopleInfoController" class="controller.SignUpPeopleInfoController">
		<property name="sessionForm" value="true" />
		<property name="successView" value="success" />
		<property name="formView" value="signUpPersonInfoSearch" />
		<property name="commandName" value="SignUpPersonSearchCommand" />
		<property name="commandClass" value="command.SignUpPersonSearchCommand" />
		<property name="registService" ref="registService" />
	</bean>
	<bean id="modifyPasswordValidator" class="validator.ModifyPasswordValidator" />
	<bean id="modifyPasswordController" class="controller.ModifyPasswordController">
		<property name="successView" value="success" />
		<property name="formView" value="modifyPassword" />
		<property name="commandName" value="ModifyPasswordCommand" />
		<property name="commandClass" value="command.ModifyPasswordCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="modifyPasswordValidator" />
			</list>
		</property>
	</bean>
	<bean id="statusSearchValidator" class="validator.StatusSearchValidator" />
	<bean id="statusSearchController" class="controller.StatusSearchController">
		<property name="sessionForm" value="true" />
		<property name="formView" value="statusSearch" />
		<property name="successView" value="statusPrint" />
		<property name="commandName" value="StatusSearchCommand" />
		<property name="commandClass" value="command.StatusSearchCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="statusSearchValidator" />
			</list>
		</property>
	</bean>
	
	<bean id="scoreSearchValidator" class="validator.ScoreSearchValidator" />
	<bean id="scoreSearchController" class="controller.ScoreSearchController">
		<property name="sessionForm" value="true" />
		<property name="formView" value="scoreSearch" />
		<property name="successView" value="scorePrint" />
		<property name="commandName" value="ScoreSearchCommand" />
		<property name="commandClass" value="command.ScoreSearchCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="scoreSearchValidator" />
			</list>
		</property>
	</bean>
	
	<bean id="verifyValidator" class="validator.VerifyValidator" />
	<bean id="verifyController" class="controller.VerifyController">
		<property name="formView" value="verify" />
		<property name="commandName" value="VerifyCommand" />
		<property name="commandClass" value="command.VerifyCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="verifyValidator" />
			</list>
		</property>
	</bean>
	<bean id="signupDetailSearchController" class="controller.SignupDetailSearchController">
		<property name="sessionForm" value="true" />
		<property name="formView" value="signUpDetailSearch" />
		<property name="commandName" value="SignupDetailSearchCommand" />
		<property name="commandClass" value="command.SignUpPersonSearchCommand" />
		<property name="registService" ref="registService" />
	</bean>
	<bean id="adminLoginValidator" class="validator.AdminLoginValidator" />
	<bean id="adminLoginController" class="controller.AdminLoginController">
		<property name="formView" value="adminLogin" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="AdminLoginCommand" />
		<property name="commandClass" value="command.AdminLoginCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="adminLoginValidator" />
			</list>
		</property>
	</bean>
	<bean id="adminModifyValidator" class="validator.AdminModifyValidator" />
	<bean id="adminModifyController" class="controller.AdminModifyController">
		<property name="formView" value="adminModify" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="AdminModifyCommand" />
		<property name="commandClass" value="command.AdminModifyCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="adminModifyValidator" />
			</list>
		</property>
	</bean>
	<bean id="adminLogoutController" class="controller.AdminLogoutController">
		<property name="successView" value="adminLogin" />
		<property name="commandName" value="AdminLoginCommand" />
		<property name="commandClass" value="command.AdminLoginCommand" />
	</bean>
	<bean id="adminInitController"
		class="org.springframework.web.servlet.mvc.SimpleFormController">
		<property name="formView" value="adminIndex" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="AdminInitCommand" />
		<property name="commandClass" value="command.AdminLoginCommand" />
	</bean>

	<bean id="roomEditValidator" class="validator.RoomEditValidator" />
	<bean id="roomEditController" class="controller.RoomEditController">
		<property name="formView" value="room/roomEdit" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="RoomEditCommand" />
		<property name="commandClass" value="command.RoomEditCommand" />
		<property name="roomService" ref="roomService" />
		<property name="validators">
			<list>
				<ref bean="roomEditValidator" />
			</list>
		</property>
	</bean>

	<bean id="roomAssignValidator" class="validator.RoomAssignValidator" />
	<bean id="roomAssignController" class="controller.RoomAssignController">
		<property name="formView" value="room/roomAssign" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="RoomAssignCommand" />
		<property name="commandClass" value="command.RoomEditCommand" />
		<property name="roomService" ref="roomService" />
		<property name="validators">
			<list>
				<ref bean="roomAssignValidator" />
			</list>
		</property>
	</bean>

	<bean id="roomListController" class="controller.RoomListController">
		<property name="formView" value="room/roomList" />
		<property name="successView" value="adminIndex" />
		<property name="commandName" value="RoomListCommand" />
		<property name="commandClass" value="command.RoomEditCommand" />
		<property name="roomService" ref="roomService" />
	</bean>

	<bean id="seatListController" class="controller.SeatListController">
		<property name="sessionForm" value="true" />
		<property name="formView" value="room/seatList" />
		<property name="commandName" value="SeatListSearchCommand" />
		<property name="commandClass" value="command.SignUpPersonSearchCommand" />
		<property name="registService" ref="registService" />
	</bean>
	
	<bean id="admissionPrintValidator" class="validator.AdmissionValidator" />
	<bean id="admissionPrintController" class="controller.AdmissionController">
		<property name="formView" value="admissionPrepare" />
		<property name="successView" value="admissionPrint" />
		<property name="commandName" value="AdmissionPrintCommand" />
		<property name="commandClass" value="command.AdmissionCommand" />
		<property name="registService" ref="registService" />
		<property name="validators">
			<list>
				<ref bean="admissionPrintValidator" />
			</list>
		</property>
	</bean>

	<bean id="userPasswordService" class="service.UserPasswordServiceImpl">
		<property name="userDao" ref="userDao"></property>
		<property name="applyDao" ref="applyDao"></property>
	</bean>
	<bean id="userPasswordResetValidator" class="validator.UserPasswordResetValidator" />
	<bean id="userPasswordResetController" class="controller.UserPasswordResetController">
		<property name="formView" value="userPasswordReset" />
		<property name="successView" value="userPasswordReset" />
		<property name="commandName" value="UserPasswordResetCommand" />
		<property name="commandClass" value="command.UserPasswordResetCommand" />
		<property name="initPassword" value="${userResetPassword}" />
		<property name="userPasswordService" ref="userPasswordService" />
		<property name="validators">
			<list>
				<ref bean="userPasswordResetValidator" />
			</list>
		</property>
	</bean>
	<bean id="userSeatResetValidator" class="validator.UserSeatResetValidator" />
	<bean id="userSeatResetController" class="controller.UserSeatResetController">
		<property name="sessionForm" value="true" />
		<property name="formView" value="room/userSeatReset" />
		<property name="successView" value="room/userSeatReset" />
		<property name="commandName" value="UserSeatResetCommand" />
		<property name="commandClass" value="command.UserSeatResetCommand" />
		<property name="roomService" ref="roomService" />
		<property name="validators">
			<list>
				<ref bean="userSeatResetValidator" />
			</list>
		</property>
	</bean>

	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix">
			<value>/view/</value>
		</property>
		<property name="suffix">
			<value>.jsp</value>
		</property>
	</bean>
	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<!-- one of the properties available; the maximum file size in bytes -->
		<property name="maxUploadSize">
			<value>2000000</value>
		</property>
	</bean>
	<bean id="exceptionResolver" class="handler.ExamHandlerExceptionResolver" />
</beans>